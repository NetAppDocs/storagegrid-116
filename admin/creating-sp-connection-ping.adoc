---
permalink: admin/creating-sp-connection-ping.html
sidebar: sidebar
keywords:
summary: 'You use Ping Federate to create a service provider (SP) connection for each Admin Node in your system. You can create SP connections by importing SAML metadata from StorageGRID.'
---
= Create SP connections in Ping Federate
:icons: font
:imagesdir: ../media/

[.lead]
You use Ping Federate to create a service provider (SP) connection for each Admin Node in your system. You can create SP connections by importing SAML metadata from StorageGRID.

.What you'll need
* You have configured identity federation for StorageGRID and you selected *AD FS* for the LDAP service type.
* You have configured single sign-on for StorageGRID and you selected *Ping Federate* as the SSO type.
* *Sandbox mode* is selected on the StorageGRID Single sign-on page.
* You have the *SP connection ID* for each Admin Node in your system.
* You have downloaded the *SAML metadata* for each Admin Node in your system.

* You have experience creating SP connections in Ping Federate, or you have access to the Ping Federate documentation.

* You are using the //Ping Tool Name with xyz permissions//.

.About this task
These instructions apply to Ping Federate version x. If you are using another version of Ping Federate, you might need to adapt these instructions.

== Prerequisites to complete in Ping Federate
Before you can create the SP connections you will use for StorageGRID, you must complete prerequisite tasks in Ping Federate. 

=== Create data store

If you haven't already, create a data store to connect Ping Federate to the AD FS LDAP server. Use the same values you used when configuring identity federation in StorageGRID.

* *Type*: Active Directory (LDAP)
* *LDAP type*: Active Directory
* *LDAP binary attributes*: On the Advanced LDAP Options tab, enter *objectGUID* (exactly as shown).

=== Create password credential validator
If you haven't already, create a password credential validator.

*	*Type*: LDAP Username Password Credential Validator
* *Data store*: Select the data store you created.
* *Search base*: Enter information from LDAP (for example, DC=saml,DC=sgws).
* *Search filter*: sAMAccountName=${username}
* *Scope*: Subtree

=== Create signing certificate
If you haven't already, create a signing certificate.

. Go to *Security* > *Signing & Decryption Keys & Certificates* > *Create New*.
. Create a signing certificate for your domain name and country.

=== Create IdP adapter
If you haven't already, create an IdP adapter.

. Go to *Authentication* > *IdP Adapters* > *Create New Instance*.
. For the type, enter *HTML Form IdP Adapter*.
. Add a new row to Credential validators, and select the password credential validator you created.
. Select username as pseudonym.
. Save the adapter settings.

== Create a SP connection in Ping Federate

When you create an SP connection in Ping Federate, you import the SAML metadata you downloaded for each Admin Node. The metadata file contains most of the values you need.

IMPORTANT: You must create an SP connection for each Admin Node in your StorageGRID system, so that users can securely sign in to and out of any Admin Node. All SP connections use identical settings, with the exception of Entity ID and Base URL.

=== Import SAML metadata

. From Ping Federate, go to *Applications* > *SP Connections*.
. Select *Create Connection*.
. For Connection Template, select *Do not use a template*.
. For Connection ??, select *Browser SSO Profiles* and *SAML 2.0* as the protocol. 
. For Import Metadata, select *File*. Then, choose the SAML metadata file you downloaded for the Admin Node. 
. Review the Metadata Summary and the information on the General Info tab.
+
The Partner's Entity ID and the Connection Name are set to the StorageGRID SP connection ID. (for example, 10.96.105.200-DC1-ADM1-105-200). The Base URL is the IP of the StorageGRID Admin Node.
. On the Browser SSO tab, select *Configure Browser SSO*.

=== Configure Browser SSO

. From *SP Connection* > *Browser SSO*, select the *SP-initiated SSO* and *SP-initial SLO* options on the SAML Profiles tab.

. On the Assertion Lifetime tab, make no changes.

. On the Assertion Creation tab, select *Configure Assertion Creation*.

==== Create assertion and adapter instance

. From *Browser SSO* > *Assertion Creation*, select *Standard* on the Identity Mapping tab.
. On the Attribute Contract tab, use SAML_SUBJECT and the unspecified name format that was imported. For Extend the Contract, select *Delete* to remove the urn:oid, which is not used.

. On the Authentication Source Mapping tab, select *Map New Adapter Instance*.

.. Select the adapter that you created as a prerequisite. 
.. Select *Retrieve Additional Attributes From a Data Store*.
.. Select *Add Attribute Source*.
.. Provide a description and select the data source that you added as prerequisite.
.. On the LDAP Directory Search tab: 
* Enter the *Base DN*, which should exactly match the value you entered in StorageGRID for the LDAP server. 
* Select *Subtree*.
* Search for the attribute *objectGUID* and add it.
* Select *Base64* for the *objectGUID* attribute.

.. On the LDAP Filter tab, enter *sAMAccountName=${username}*.

.. On the Attribute Contract Fulfillment tab, select *LDAP (attribute)* as the source and *objectGUID* as the value.
+
NOTE: If objectGUID doesn't appear as an option, make sure it is defined as *Base64* on the LDAP Directory Search tab.

.. Review and then save the attribute source. For example:
+
image::../media/sso_ping_sp_connection_attribute_source.png[SP Connection for Ping Federate-Attribute Sources]

..	On the Failsave Attribute Source tab, select *Abort the SSO Transaction*.

.. Review the summary and select *Done* to save the adapter instance.

. Select *Done* to save the assertion.

==== Define protocol settings

. From *Browser SSO* > *Protocol Settings*, select *Configure Protocol Settings* on the Protocol Settings tab.
..	On the Assertion Consumer Service URL tab, accept the default values, which were imported from the StorageGRID SAML metadata (*POST* for Binding and `/api/saml-response` for Endpoint URL).

.. On the SLO Service URLs tab, accept the default values, which were imported from the StorageGRID SAML metadata (*REDIRECT* for Binding and `/api/saml-logout` for Endpoint URL.

.. On the Allowable SAML Bindings tab, unselect *ARTIFACT* and *SOAP*. Only *POST* and *REDIRECT* are required.

.. On the Signature Policy tab, select *Always Sign Assertion*.

.. On the Encryption Policy tab, select *None*.

.. Review the summary and select *Done* to save the protocol settings.

.	Review the summary and select *Done* to save the Browser SSO settings.



==== Configure credentials

. From the SP Connection tab, select *Credentials*. 
. From the Credentials tab, select *Configure Credentials*.

. Select *Done* to save the credentials.

. On the Signature Verifications Settings tab, select *Manage Signature Verification Settings*.

.. On the Trust Model tab, select *Unanchored*.
.. On the Signature Verification Certificate tab, review the signing certificate information, which was imported from the StorageGRID SAML metadata. 

. Review the summary screens and select *Save* to save the SP connection.



